<div  class="container manager" >
    <div class="row">
      <!-- <div  id="manmenu--" class="span1 mmenu-sidebar"><div ng-show="state.connected && state.advanced" id="manmenu"
     class="navigation" >
  <ul class="nav nav-list sidemenu" data-spy="affix"
      data-offset-top="130">
    <li ng-repeat="screen in screens" class="{{isActive('#' + screen.name)}}"><a   ng-click="click($event)" href="#{{screen.name}}"><i class="icon-chevron-right"></i>{{screen.menu}}</a></li>
  </ul>
</div>

</div> -->
      <div id="manager--"  class="span12" ><div ng-hide="state.connected">
  <div  id="setupConnection--" ><p ng-hide="disconnected"> 
I have tried to connect to CouchDB with the following two addresses:
</p>

<p ng-show="disconnected"> Please enter the urls of the CouchDB you want to try to connect to:</p>

<ul>
<li><p><a href="#" id="couchDBurl" data-type="text"></a> (CouchDB)</p></li>
<li><p><a href="#" id="corsProxy" data-type="text" ></a> (Cors proxy)</p></li>
</ul>

<div ng-hide="disconnected">
Neither of them gave back a valid response.

Please correct them (by clicking on them) and then click the connect
button or refresh the page.
</div>

<p><button class="btn btn-small btn-primary" ng-click="connect()">Connect</button></p></div>
  <!-- <div ng-show="disconnected" id="setupConnectionDisconnected--" ></div> -->
  <a  ng-click="isSetupConnectionHelpCollapsed =
		!isSetupConnectionHelpCollapsed">Help on how to
		enable access to CouchDB click here.</a>
  <brk>
    <div id="setupConnectionHelp--" collapse="isSetupConnectionHelpCollapsed"><p>For windows do the following: </p>

<ul>
<li><p>Download <a href="http://www.apache.org/dyn/closer.cgi?path=/couchdb/binary/win/1.3.1/setup-couchdb-1.3.1_R15B03-1.exe">CouchDB</a>. Install, say 'Yes' when
asked to run the database as a service.</p></li>
<li><p>Download this <a href="cors-proxy.zip">utility</a>. Unzip it somewhere and double-click
the cors-proxy.bat in th unzipped folder.</p></li>
<li><p>Refresh this page, or click the connect button</p></li>
</ul>

<p>More help:</p>

<p>If you still can't connect this could be for the following reasons:</p>

<ul>
<li><p>You have not installed CouchDB.</p>

<p>Please download CouchDB for windows from <a href="http://www.apache.org/dyn/closer.cgi?path=/couchdb/binary/win/1.3.1/setup-couchdb-1.3.1_R15B03-1.exe">here</a>,
for mac <a href="http://www.apache.org/dyn/closer.cgi?path=/couchdb/binary/mac/1.3.1/Apache-CouchDB-1.3.1.zip">here</a> and linux <a href="http://www.apache.org/dyn/closer.cgi?path=/couchdb/source/1.3.1/apache-couchdb-1.3.1.tar.gz">here</a>.
Installing is a matter of just clicking Next. There is one step that
asks you wheter you want run the database as a service. If you say
'No' you will have to manually start CouchDB on every restart of your computer.
After downloading and installing come back to this page.</p></li>
<li><p>CouchDB is installed but is not configured properly (which it isn't
after a fresh install).</p>

<p>You can remedy this by doing one of the following:</p>

<ol><li><p>Download this little <a href="cors-proxy.zip">utility</a>. Unzip its content
somewhere on you hard drive and double click the cors-proxy.bat in the unzipped
folder.  Under Linux install node.js first, then execute "node server.js". That should
work on a Mac as well. Then come back to this page and refresh
or click the connect button. This proxy server assumes your CouchDB
instance is on http;//localhost:5984<p>
I will then try to configure CouchDb to enable access without having to
use this little utility. This will only work with a CouchDB that is
not locked down yet with a server admin password (as is the case
after a fresh install). <p>
This is the simplest solution for a fresh install.</p></li>
<li><p>Download this <a href="local.ini">file</a>. In windows copy this to
C:\Program Files (x86)\Apache Software
Foundation\CouchDB\etc\couchdb\local.ini. In Linux it is somewhere
like /usr/local/etc/couchdb/local.ini Overwrite the file that's
there already. Restart the CouchDB service, or restart the
computer. CouchDB should now be accessible from this site. <br>
<strong><em>Warning: Don't do this if you or somebody else has already configured CouchDB at  all. Besides clobbering current settings, it also will remove any existing server admins and set up a new admin (with password admin).</em></strong></p></li>
<li><p>If you know what you're doing go to the database config page, most
likely <a href="http://localhost:5984/_utils/config.html">here</a> for a local
install. If your CouchDB is on a network somewhere you will need to
replace the <em>localhost:5984</em> part of this address with the proper address and
port. <p> 
You will need server admin credentials for a locked down CouchDB. On
a fresh install you don't. Look for the option <strong>enable_cors</strong> and
change its value to <strong>true</strong>. Look for the <strong>credentials</strong> options and
change its value to <strong>true</strong>. Then go to the bottom of the page and
click <strong>Add a new section</strong>. Fill in <strong>cors</strong>, <strong>origins</strong> and <strong>*</strong>
for <strong>section</strong>, <strong>option</strong> and <strong>value</strong> respectively. Refresh this page or click the
connect button.</p></li></ol></li>
<li><p>CouchDB is installed and configured properly but neither of the addresses entered
at the top of the page are correct. </p>

<ul><li><p>Carefully check the addresses you've
entered. If the cors proxy address worked before but not any more
now it might be because the CouchDB is actually configured correctly for cors
access now. Accessing a cors enabled server via a cors proxy is
problematic it seems. So check the database's direct address
carefully, because that should work now.</p></li>
<li><p>Is the port correct? For instance if you're CouchDB is on a https address the port is
probably 6984. </p></li>
<li><p>The second address is the default address for the
little CorsProxy server that enables access. If you have a different
cors proxy server that enables access to your CouchDB fill that in
there. </p></li>
<li><p>Can you open the default address for the CouchDB instance in
a browser window? For a local CouchDB this is for instance
<a href="">http://localhost:5984</a>. You should see a empty page with
something like:</p>

<p>{"couchdb":"Welcome","uuid":"4418cad0d9bd42aabccad6cd71d1b5eb","version":"1.3.0","vendor":{"version":"1.3.0","name":"The
Apache Software Foundation"}}</p></li></ul></li>
</ul>

<p>The above tips assume you want the simplest setup possible. If you
don't want to enable cors for the CouchDB server you can use the
cors proxy server for all future access to the database. You will
have to run it every time before you use the roster app. You could
put it in the startup folder of windows. Your access will be through
the address http://localhost:1234. </p>

<p>If your setup is more complicated than above or it is not working contact me on <a href="&#109;&#97;&#105;&#108;&#116;&#111;:&#109;&#x69;&#99;&#104;i&#x65;&#x6C;&#106;&#x6F;&#x72;&#x69;&#x73;&#64;&#103;&#109;&#97;&#x69;l&#x2E;&#99;om">&#109;&#x69;&#99;&#104;i&#x65;&#x6C;&#106;&#x6F;&#x72;&#x69;&#x73;&#64;&#103;&#109;&#97;&#x69;l&#x2E;&#99;om</a></p></div>
</div>

<div ng-show="state.connected ">
  <div ng-show="isActive('#enableCors')" id="enableCors--"><p>This website and the roster app can't access the
CouchDB server directly because they are served from different
origins. But to configure CouchDB for our needs we needed access to
it. That's why you either installed a 'cors proxy' or
configured CouchDB manually to enable this access. </p>

<p>However you need to choose a solution for long term access. My recommendation
is to 'enable cors' for the CouchDB server. See below for other
options.</p>

<p ng-show="state.corsConfigured">
It looks like your CouchDB is configured just the way I need it to
be (<a href="#" ng-click="checkCors($event)">check again</a>). If
you're happy with this (I would) <a href="#"
ng-click="checkCors($event)">go on</a> to setting up your
database. If not read on.
</p>

<p ng-show="!state.configAccessible && !state.corsConfigured">
 <b>Please click the button and log in with server admin
 credentials so I can check whether cors settings have been configured
 correctly.</b>

<br>
<button class="btn btn-small btn-primary" ng-click="openLogin()">Log in</button>
</p>

<div ng-show="state.configAccessible && !state.corsConfigured">
To enable cors and enable the roster app to access the database
directly a certain number of settings need to be applied.
<p><p>    

<button class="btn btn-small btn-primary" ng-click="enableCors($event)">
Automatically apply cors settings to CouchDB</button>
<p>
For info on how to do this manually please <a href="#"
ng-click="reset($event)">disconnect</a> and look at the help on how to
enable access to CouchDB.
<p>

<a  ng-click="isCorsSettingsCollapsed =
!isCorsSettingsCollapsed">Click to see the settings that will be applied: </a>

<div collapse= "!isCorsSettingsCollapsed">
<pre>{{defaults.corsSettings | json}}</pre>
</div>

<p></div></p>

<hr />

<h3>Other options:</h3>

<ul>
<li><p>You can choose not too modify CouchDB at all. But you will have to have a cors
proxy in the background at all times so the roster app can access the
database. <span ng-show="state.maybeCors">
It looks like we're accessing CouchDB through cors proxy at the
moment. If so, you're done. 
</span> </p>

<p>For info on how install to install this proxy <a href="#" ng-click="reset($event)">disconnect</a> and look at the help on how to enable access to CouchDB.</p></li>
<li><p>The third option is to serve the roster app and this app from
CouchDB, then they both come from the same domain, and the problem is
solved. 
<span ng-show="state.servedFromCouchDb">
It looks like this app is already server from CouchDB. <br />
</span>
<span ng-hide="state.servedFromCouchDb">
<span ng-hide="state.configAccessible">
<b>Please click the button right top and log in with server admin
credentials so I can replicate this and the roster app to your CouchDB.</b>
</span>
<span ng-show="state.configAccessible">
To make this happen please click the button:<br><br>
<button class="btn btn-small btn-primary" ng-click="enableCors($event)">
Replicate this app and the roster app to your CouchDB</button>
</span>
</span></p>

<p>Go to <a href="{{state.connected}}/quilt">{{state.connected}}/quilt</a>
for this app, and <a target="_blank" href="{{state.connected}}/roster">{{state.connected}}/roster</a> for the roster.</p></li>
</ul></div>
  <div ng-show="isActive('#simple')" id="simple--"><p>Setup CouchDB</p>

<hr />

<div ng-hide="state.configAccessible">
<b><em>Please click the button to login as a server admin so I can setup your CouchDB.</em></b>
<button class="btn btn-small btn-primary" ng-click="openLogin()">Log
in your CouchDB</button>
</div>

<p><span ng-show="state.partyMode">
Your CouchDB is in party mode as it's called. Which means there is no
server admin configured. This makes your database quite insecure. It
is not strictly necessary, but highly recommended to create a server
admin. Please click the button to do so.
<button class="btn btn-small btn-primary" ng-click="createServerAdmin()">Log
in your CouchDB</button>
</span></p>

<p><b><i>Please supply the address and credentials for the remote CouchDB you want to
synchronize with.<p></i></b></p>

<p>Remote CouchDB: <a href="#" id="remoteUrl" data-type="text"></a> <br>
User name: <a href="#" id="remoteUserName" data-type="text" ></a> <br> 
Password: <a href="#" id="remotePassword" data-type="password" ></a> <br></p>

<p><b><i>Please edit the list of locations you want to synchronize with
your CouchDB.<p></i></b>
<a href="#" id="locationsToSync" data-type="checklist"
data-original-title="Select locations"></a> <br></p>

<p><p><p></p>

<p><button class="btn btn-small btn-primary"
ng-click="setupSimple()">Setup your CouchDB!!</button></p></div>
  <div ng-show="isActive('#info')" id="info--"><p>Intro</p></div>
  <div ng-controller="serverAdminsCntl" ng-show="isActive('#serverAdmins')" id="serverAdmins--"><div ng-hide="state.configAccessible">
<b><em>Please click the button to login as a server admin so I can setup your CouchDB.</em></b><p>
<button class="btn btn-small btn-primary" ng-click="openLogin()">Log
in your CouchDB</button>
</div>

<div ng-show="state.configAccessible">
<div ng-show="getAdminNames().length==0">Your CouchDB is in party
mode! <p></p>Everyone is admin. Please add an server admin user to fix this.. </div>
<ul >
<li style="list-style-type:none;" ng-repeat="admin in getAdminNames()">
<a style="color:orange;padding-right:5px;" href="" ng-click="removeAdminUser(admin)">x</a> <a href="" ng-click="setPwd(admin)">{{admin}}</a> 
</li>
</ul>

<button class="btn btn-small btn-primary"
ng-click="addAdminUserDialog()">Create new
server admin</button>

<!-- <pre>{{getAdminNames() | json}}</pre> -->

<!-- <pre>{{state.configAccessible | json}}</pre> -->

</div>

<div id="addAdminDialog" modal="newAdminShouldBeOpen" close="closeAdmin()" options="logopts">
  <div class="modal-header">
    <h3 ng-hide="justPwd">Create server admin</h3>
    <h3 ng-show="justPwd">{{userName}}</h3>
  </div>
  <div class="modal-body">
    <form>
      <fieldset>
        <input ng-hide="justPwd" type="text" placeholder="new server admin name" ng-model="userName"><br>
        <input type="password" placeholder="password" ng-model="password">
      </fieldset>
    </form>

      </div>
      <div class="modal-footer">
        <button class="btn btn-warning cancel pull-left" ng-click="closeAdmin()">Cancel</button>
        <button ng-hide="justPwd" class="btn btn-primary" ng-click="addAdminUser()">Ok</button>
        <button ng-show="justPwd" class="btn btn-primary" ng-click="addAdminUser()">Set</button>
      </div>
</div></div>
  <div ng-controller="usersCntl" ng-show="isActive('#users')" id="users--"><!-- Users -->
<!-- <hr> -->

<!-- <p></p> -->

<div ng-hide="state.configAccessible">
  <b><em>Please click the button to login as a server admin so I can setup your CouchDB.</em></b><p>
    <button class="btn btn-small btn-primary" ng-click="openLogin()">Log
      in your CouchDB</button>
</div>

<div ng-show="state.configAccessible">
  <div class="row">
    <div class="span3">
      
      Search: <input style="width:140px;"
      ng-model="searchText">
      
      <button class="pull-right btn btn-small btn-info"
	      ng-click="addUserDialog()"><i class="icon-plus"></i></button><p></p>
      <div class="well well-small scrollBox" ng-show="state.configAccessible">
	<ul>
	  <li ng-repeat="user in state.users | filter:searchText">
	    <a style="color:orange; padding-right:10px;" href="" ng-click="removeUser(user)">x</a>
	    <a href="" ng-click="editUser(user)">{{user.slice(17)}}</a>
	  </li>
	</ul>

      </div>
    </div>
    <div ng-show="selectedUser" class="span4">
      <h3>{{selectedUser._id.slice(17)}}</h3>
      Password: <a href="#" id="changeUserPwd" data-type="password"></a><br>
      
      <!-- Roles: <a href="#" id="userRoles" data-type="select2"></a> <br> -->
      Roles: <br> <a href="#" id="userRoles" data-type="checklist"></a> <br>
      <p></p>
      
      <button ng-show="edited" class="btn btn-small btn-primary" ng-click="apply()">Apply</button>
      
      <!-- <pre>{{selectedUser | json}}</pre> -->
    </div>
  </div>


  <div id="addUserDialog" modal="newUserShouldBeOpen" close="closeUser()" options="logopts">
    <div class="modal-header">
      <h3>Create user</h3>
    </div>
    <div class="modal-body">
      <form>
	<fieldset>
	  <input type="text" placeholder="new user name" ng-model="userName"><br>
	  <input type="password" placeholder="password" ng-model="password">
	</fieldset>
      </form>

    </div>
    <div class="modal-footer">
      <button class="btn btn-warning cancel pull-left" ng-click="closeUser()">Cancel</button>
      <button class="btn btn-primary" ng-click="addUser()">Ok</button>
    </div>
  </div>


  <!-- <pre>{{getAdminNames() | json}}</pre> -->

  <!-- <pre>{{state.configAccessible | json}}</pre> -->
</div>
</div>
  <div ng-controller="databasesCntl" ng-show="isActive('#databases')" id="databases--"><!-- Databases -->
<!-- <hr> -->

<!-- <p></p> -->

<div ng-hide="state.configAccessible">
  <b><em>Please click the button to login as a server admin so I can setup your CouchDB.</em></b><p>
    <button class="btn btn-small btn-primary" ng-click="openLogin()">Log
      in your CouchDB</button>
</div>

<div class="row">
  <div class="span3">
    Search: <input style="width:140px;" ng-model="searchText">
    
    <button class="pull-right btn btn-small btn-info"
	    ng-click="addDatabaseDialog()"><i class="icon-plus"></i></button><p></p>
    
    <div class="well well-small scrollBox" >
      <ul>
	<li ng-repeat="database in state.databases | filter:searchText">
	  <a style="color:orange; padding-right:10px;" href="" ng-click="removeDatabase(database)">x</a>
	  <a ng-style="styleSelectedDb(database)" href="" ng-click="editDatabase(database)">{{database}}</a>
	</li>
      </ul>
    </div>

    <!-- <button class="btn btn-small btn-primary" -->
		 <!-- ng-click="addDatabaseDialog()">Create new database</button> -->
  </div>
  
  <div class="span9">
    <div ng-show="selectedDatabase">
    <span class="title">{{selectedDatabase}}</span>
    (docs:{{dbInfo.doc_count}} update_seq:{{dbInfo.update_seq}})
    </div>
    <span ng-hide="selectedDatabase">Select a  database</span>
    <div class="tabbable span9"> 
      <ul class="nav nav-tabs">
	<li  ng-repeat="tab in tabs">
	  <a href="#tab{{$index}}" data-toggle="tab">{{tab.title}}</a>
	</li>
      </ul>
      <div class="tab-content" >
	<div class="tab-pane" ng-repeat="tab in tabs"
	     id="tab{{$index}}">
	  <div ng-include src="tab.url"></div>
	</div>
      </div>
    </div>
  </div>
  
  
  <!-- <div ng-show="selectedDatabase" class="span8"> -->
    
    
  <!--   <h3>{{selectedDatabase}}</h3> -->
  <!--   <h5>Read permissions</h5> -->
  <!--   <\!-- Roles: <a href="#" id="userRoles" data-type="select2"></a> <br> -\-> -->
  <!--   Users: <br> <a href="#" id="dbMemberNames" data-type="select2"></a> <br> -->
  <!--   Roles: <br> <a href="#" id="dbMemberRoles" data-type="select2"></a> <br> -->
  <!--   <p></p> -->
    
  <!--   <button ng-show="edited" class="btn btn-small btn-primary" ng-click="apply()">Apply</button> -->
    
  <!--   <h5>Design documents</h5> -->
  <!--   <ul> -->
  <!--     <li ng-repeat="ddoc in ddocs">{{ddoc}}</li> -->
  <!--   </ul> -->
    
  <!--   <pre>{{designDocs | json}}</pre> -->
  <!--   <pre>{{secObj | json}}</pre> 
  <!-- </div> -->
</div>


<div id="addDatabaseDialog" modal="newDatabaseShouldBeOpen" close="closeDatabase()" options="logopts">
  <div class="modal-header">
    <h3>Create database</h3>
  </div>
  <div class="modal-body">
    <form>
      <fieldset>
	<input type="text" placeholder="new database name" ng-model="dbName"><br>
      </fieldset>
    </form>

  </div>
  <div class="modal-footer">
    <button class="btn btn-warning cancel pull-left" ng-click="closeDatabase()">Cancel</button>
    <button class="btn btn-primary" ng-click="addDatabase()">Ok</button>
  </div>
</div>


<!-- <pre>{{getAdminNames() | json}}</pre> -->

<!-- <pre>{{state.configAccessible | json}}</pre> -->

</div>
  <div ng-controller="scriptsCntl" ng-show="isActive('#scripts')" id="scripts--">It's working!!
<pre id="editor">function foo(items) {
  var i;
  for (i = 0; i &lt; items.length; i++) {
  alert("Ace Rocks " + items[i]);
  }

  }</pre>

<button ng-click="full()">Full</button>
<button ng-click="setDesign()">setDesign</button>
</div>
  <div ng-controller="replicationsCntl" ng-show="isActive('#replications')" id="replications--"><div class='row' style='margin-left: 0; padding-left:10px; border:solid grey 1px; height:40; width:100%;'>placeholder for markdown/replications.md</div></div>
</div>
</div>
      <!-- <div id="rightBar--"  class="span2" > -->
      </div>
    </div>
</div> 


